rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    
    // 프로필 이미지 업로드 및 관리
    match /profile_images/{userId}/{imageId} {
      // 본인의 프로필 이미지만 업로드/읽기/삭제 가능
      allow read, write: if request.auth != null && request.auth.uid == userId;
      
      // 업로드 시 파일 크기 및 타입 제한
      allow write: if request.auth != null 
        && request.auth.uid == userId
        && resource.size < 5 * 1024 * 1024  // 5MB 제한
        && request.resource.contentType.matches('image/.*');  // 이미지 파일만
    }
    
    // 그룹 이미지 (그룹 대표 이미지 등)
    match /group_images/{groupId}/{imageId} {
      // 그룹 멤버만 읽기 가능
      allow read: if request.auth != null;
      
      // 그룹 방장만 업로드/수정/삭제 가능 (추후 구현 시)
      allow write: if request.auth != null
        && resource.size < 3 * 1024 * 1024  // 3MB 제한
        && request.resource.contentType.matches('image/.*');
    }
    
    // 채팅 이미지 (채팅에서 전송하는 이미지)
    match /chat_images/{groupId}/{messageId} {
      // 해당 그룹 멤버만 읽기 가능
      allow read: if request.auth != null;
      
      // 인증된 사용자만 업로드 가능
      allow write: if request.auth != null
        && resource.size < 10 * 1024 * 1024  // 10MB 제한
        && request.resource.contentType.matches('image/.*');
    }
    
    // 임시 이미지 (업로드 중인 이미지)
    match /temp_images/{userId}/{imageId} {
      // 본인만 업로드/읽기/삭제 가능
      allow read, write: if request.auth != null && request.auth.uid == userId;
      
      // 파일 크기 제한
      allow write: if request.auth != null 
        && request.auth.uid == userId
        && resource.size < 15 * 1024 * 1024;  // 15MB 제한
    }
    
    // 기본 거부: 위에 정의되지 않은 모든 경로는 접근 불가
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
} 